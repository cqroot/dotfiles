#!/usr/bin/env bash

# Determine Go bin directory
resolve_go_bin() {
    # Use GOBIN if explicitly set
    if [[ -n "${GOBIN}" ]]; then
        echo "${GOBIN}"
        return
    fi

    # Otherwise use first GOPATH entry + /bin
    if [[ -n "${GOPATH}" ]]; then
        local primary_gopath=$(cut -d':' -f1 <<<"${GOPATH}")
        echo "${primary_gopath}/bin"
    else
        # Fallback to default $HOME/go/bin
        echo "${HOME}/go/bin"
    fi
}

# Main function
main() {
    local bin_dir=$(resolve_go_bin)

    if [[ ! -d "${bin_dir}" ]]; then
        echo "Error: The Directory ${bin_dir} does not exist" >&2
        return 1
    fi

    case "$1" in
    "" | list)
        # List all binaries in bin directory
        ls -lh --color "$bin_dir"
        ;;
    remove)
        # Remove specified binaries
        if [ $# -lt 2 ]; then
            echo "Error: Please specify binary name(s) to remove" >&2
            echo "Usage: $0 remove <binary1> [binary2 ...]" >&2
            exit 1
        fi

        shift # Remove 'remove' argument
        for binary in "$@"; do
            local target="${bin_dir}/${binary}"

            if [ -f "$target" ]; then
                rm -v "$target"
            else
                echo "Warning: Binary not found - $binary" >&2
            fi
        done
        ;;
    *)
        echo "Error: Invalid command '$*'" >&2
        echo "Usage:"
        echo "  $0 [list]         List installed binaries"
        echo "  $0 remove <name>  Remove specified binary(ies)"
        exit 1
        ;;
    esac
}

# Execute main function
main "$@"
